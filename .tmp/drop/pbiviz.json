{"visual":{"name":"rPlotSmooth","displayName":"RPlotSmooth","guid":"PBI_CV_E67F6187_8266_4C40_822B_369EDD127725","visualClassName":"Visual","version":"1.0.0","description":"","supportUrl":"","gitHubUrl":""},"apiVersion":"1.4.0","author":{"name":"","email":""},"assets":{"icon":"assets/R.png"},"externalJS":[],"style":"style/visual.less","capabilities":{"dataRoles":[{"displayName":"Values","kind":"GroupingOrMeasure","name":"Values"}],"dataViewMappings":[{"scriptResult":{"dataInput":{"table":{"rows":{"select":[{"for":{"in":"Values"}}],"dataReductionAlgorithm":{"top":{}}}}},"script":{"scriptProviderDefault":"R","scriptOutputType":"html","source":{"objectName":"rcv_script","propertyName":"source"},"provider":{"objectName":"rcv_script","propertyName":"provider"},"scriptSourceDefault":"FlattenHTML <- function(fnameIn, fnameOut)\n{\n  library(XML)\n  \n  # Read and parse HTML file\n  if(!file.exists(fnameIn))\n    return(FALSE)\n  \n  dir = dirname(fnameIn)\n  html = htmlTreeParse(fnameIn,useInternal = TRUE)\n  top = xmlRoot(html)\n  \n  # extract all <script> tags with src value\n  srcNode=getNodeSet(top, '//script[@src]')\n  for (node in srcNode)\n  {\n    b=xmlAttrs(node)\n    f = file.path(dir, b['src'])\n    alternateSrc = FindSrcReplacement(f)\n    if (!is.null(alternateSrc))\n    {\n      s = alternateSrc\n      names(s)=c('src')\n      newNode=xmlNode(\"script\",attrs=s)\n      replaceNodes(node, newNode)\n    }else{\n      str=ReadFileForEmbedding(b['src']);\n      if (is.null(str)) continue\n      \n      newNode=xmlNode(\"script\", str, attrs=c(type=\"text/javascript\"))\n      replaceNodes(node, newNode)\n    }\n  }\n  \n  # extract all <link> tags with src value\n  linkNode=getNodeSet(top, '//link[@href]')\n  for (node in linkNode)\n  {\n    b=xmlAttrs(node)\n    f = file.path(dir, b['href'])\n    str=ReadFileForEmbedding(f);\n    if (is.null(str)) continue\n    \n    newNode=xmlNode(\"style\", str)\n    replaceNodes(node, newNode)\n  }\n  \n  saveXML(html, file=fnameOut)\n  return(TRUE)\n}\n\nReadFullFile <- function(fname)\n{\n  if(!file.exists(fname))\n    return(NULL)\n\n  con=file(fname,open=\"r\")\n  data = readLines(con)\n  close(con)\n  return(data)\n}\n\nReadFileForEmbedding <- function(fname)\n{\n  data = ReadFullFile(fname)\n  if (is.null(data))\n    return(NULL)\n\n  str = paste(data, collapse ='\\n')\n  str = paste(cbind('// <![CDATA[', str,'// ]]>'), collapse ='\\n')\n  return(str)\n}\n\nFindSrcReplacement <- function(str)\n{\n  str <- iconv(str, to=\"UTF-8\")\n  pattern = \"plotlyjs-(\\\\w.+)/plotly-latest.min.js\"\n  match1=regexpr(pattern, str)\n  attr(match1, 'useBytes')<-FALSE\n  strMatch=regmatches(str, match1, invert = FALSE)\n  if (length(strMatch)==0) return(NULL)\n  \n  pattern2 = \"-(\\\\d.+)/\"\n  match2 = regexpr(pattern2, strMatch[1])\n  attr(match2, 'useBytes')<-FALSE\n  s=regmatches(strMatch[1], match2)\n  if (length(s)==0) return(NULL)\n  \n  verstr=substr(s, 2, nchar(s)-1)\n  str = paste('https://cdn.plot.ly/plotly-', verstr,'.min.js', sep='')\n  return(str)\n}\n\ninternalSaveWidget <- function(w, fname)\n{\n  saveWidget(w, file=fname, selfcontained = FALSE)\n  FlattenHTML(fname, fname)\n}\n####################################################################\n\n###############Library Declarations###############\n\nlibraryRequireInstall = function(packageName, ...)\n{\n  if(!require(packageName, character.only = TRUE)) \n    warning(paste(\"*** The package: '\", packageName, \"' was not installed ***\",sep=\"\"))\n}\n\n#ets\nlibraryRequireInstall(\"htmlwidgets\")\nlibraryRequireInstall(\"ggplot2\")\nlibraryRequireInstall(\"plotly\")\n\n###############Internal parameters definitions#################\n\n# actual code here\ndataset2 <- Values\ndataset2 <- aggregate(dataset2, by = list(dataset2$Year), FUN = mean, na.rm = TRUE )\n\nattach(dataset2)\np <- plot_ly(dataset2, x = Year, y = Value)\np <- add_trace(p, y = fitted(loess(Value ~ as.numeric(Year))), x = Year)\np <- layout(p, title = \"# Road Accidents (per year)\", showlegend = FALSE)\ndetach(dataset2)\n# code end\n\nw = as.widget(p)\ninternalSaveWidget(w, out.html)\n\n#Sys.sleep(20)\n####################################################################"}}}],"objects":{"rcv_script":{"properties":{"provider":{"type":{"text":true}},"source":{"type":{"scripting":{"source":true}}}}}},"suppressDefaultTitle":true},"dependencies":{"cranPackages":[{"name":"ggplot2","displayName":"GG Plot 2","url":"https://cran.r-project.org/web/packages/ggplot2/index.html"},{"name":"plotly","displayName":"Plotly","url":"https://cran.r-project.org/web/packages/plotly/index.html"},{"name":"htmlwidgets","displayName":"htmlwidgets","url":"https://cran.r-project.org/web/packages/htmlwidgets/index.html"}]},"content":{"js":"var powerbi;!function(i){var t;!function(i){var t;!function(i){var t;!function(i){}(t=i.PBI_CV_E67F6187_8266_4C40_822B_369EDD127725||(i.PBI_CV_E67F6187_8266_4C40_822B_369EDD127725={}))}(t=i.visual||(i.visual={}))}(t=i.extensibility||(i.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(i){var t;!function(i){var t;!function(i){var t;!function(i){function t(i,t,e,n){if(i){var a=i[t];if(a){var r=a[e];if(void 0!==r)return r}}return n}function e(i,t,e,n){if(i){var a=i[t];if(a){var r=a[e];if(void 0!==r&&void 0!==r.solid&&void 0!==r.solid.color)return r.solid.color}}return n}i.getValue=t,i.getFillValue=e}(t=i.PBI_CV_E67F6187_8266_4C40_822B_369EDD127725||(i.PBI_CV_E67F6187_8266_4C40_822B_369EDD127725={}))}(t=i.visual||(i.visual={}))}(t=i.extensibility||(i.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(i){var t;!function(i){var t;!function(i){var t;!function(i){var t=function(){function i(i){this.iframeElement=document.createElement(\"iframe\"),this.iframeElement.setAttribute(\"sandbox\",\"allow-scripts\"),i.element.appendChild(this.iframeElement)}return i.prototype.update=function(i){var t=i.dataViews;if(t&&0!==t.length){var e=t[0];if(e&&e.metadata){this.updateObjects(e.metadata.objects);var n=null;if(e.scriptResult&&e.scriptResult.payloadBase64){var a=e.scriptResult.payloadBase64;n=window.atob(a)}n?this.iframeElement.setAttribute(\"srcdoc\",n):this.iframeElement.setAttribute(\"srcdoc\",\"<p>Not really updating... and where is my payload???</p>\"),this.onResizing(i.viewport)}}},i.prototype.onResizing=function(i){this.iframeElement.style.height=i.height+\"px\",this.iframeElement.style.width=i.width+\"px\"},i.prototype.updateObjects=function(i){},i.prototype.enumerateObjectInstances=function(i){var t=(i.objectName,[]);return t},i}();i.Visual=t}(t=i.PBI_CV_E67F6187_8266_4C40_822B_369EDD127725||(i.PBI_CV_E67F6187_8266_4C40_822B_369EDD127725={}))}(t=i.visual||(i.visual={}))}(t=i.extensibility||(i.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(i){var t;!function(t){var e;!function(t){t.PBI_CV_E67F6187_8266_4C40_822B_369EDD127725={name:\"PBI_CV_E67F6187_8266_4C40_822B_369EDD127725\",displayName:\"RPlotSmooth\",class:\"Visual\",version:\"1.0.0\",apiVersion:\"1.4.0\",create:function(t){return new i.extensibility.visual.PBI_CV_E67F6187_8266_4C40_822B_369EDD127725.Visual(t)},custom:!0}}(e=t.plugins||(t.plugins={}))}(t=i.visuals||(i.visuals={}))}(powerbi||(powerbi={}));","css":".visual-PBI_CV_E67F6187_8266_4C40_822B_369EDD127725 .rcv_autoScaleImageContainer{position:relative}.visual-PBI_CV_E67F6187_8266_4C40_822B_369EDD127725 .rcv_autoScaleImageContainer .rcv_autoScaleImage{max-width:100%;max-height:100%;position:absolute;top:50%;left:50%;transform:translateY(-50%) translateX(-50%);-webkit-transform:translateY(-50%) translateX(-50%)}.visual-PBI_CV_E67F6187_8266_4C40_822B_369EDD127725 iframe{border:none !important}","iconBase64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTCtCgrAAAACt0lEQVQ4T8WUX0hTYRjGz7ZzdjY359ycmgz6QyVEmKGU1IUWZYFgEe5C8SohKzCNboKoQUGlgUJeREGBWvTHogTTUiMjtChtWFrM6kJsFloqRf+gnqfP8WHEUtdVP3gv3vd73uc8B75zlP8K+z12hGI2IajuwYDtKJ6Zy/HUmSaPowdvbcsxamrAkPEbnyvkM1lPRfUpREA7JaWzQyomjuvHMab8YFAaPDEQLdpXnLQFsStujEVOslklHjtWybW/Ayg6JtSb/CBM+qdSGH6iV21EiyOXPRnalIanMzRsc13mOZ18oOeEF2cC79ULnDCIVCJRr+kTAjF58ugPUG2rQqcW4t1sixxFgneWIo4LsxfC7JEw63FlyaNpcC9pIdr1SrRrX9Bh2yjHkWBwsY6QGmLISHQZf6LrdzKMJizBoH4EnXo/WlWgRR1Ha+xfk0+DVyLdsJEMmIhO85mpGSfjFmHMco1Bjbytkk0acUO/jmtWb3hpNjCgX+VLYdamfkebOwWT8Zs4qk0yIMyuC6OL5hE02rdI+dygRx/mQ3ENmkSC1wlLMWT+yG4zed5MVFnvoCzZI6Vzw36/Wbwm2CyWL1t3os9+iV0W8qxOVFha6VNMUhoduOV1TZmxThjUJWei3fqZ9VbSL/odyZlSFj1oSEllvYWotU7wisfO8zFktagKYVjsXi9l0cNadw5rYojK2Ebx2RlQ4xih307uthL59lskDVIaHTjsLOYhYXDA5Qv3+x0HuddBlorKFw9abauiohjD4mjAPtcxlDve0L/MHO7LxCXf7r7PQvEDKIgnc+OItc5uZs/biqJ184X57IlREt+BksRS2YbBZmGal3gCG9xfmJ1ArhGV6SFWJt3GxjSblEVC3/xk+BKvyjYC5KfGIsu7GRneQqQvWCHHM4OCdM8/37MIFOUXcOCKM5YAXLAAAAAASUVORK5CYII="}}
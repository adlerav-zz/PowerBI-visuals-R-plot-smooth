{"visual":{"name":"rPlotSmooth","displayName":"RPlotSmooth","guid":"PBI_CV_E67F6187_8266_4C40_822B_369EDD127725","visualClassName":"Visual","version":"1.0.0","description":"","supportUrl":"","gitHubUrl":""},"apiVersion":"1.4.0","author":{"name":"","email":""},"assets":{"icon":"assets/R.png"},"externalJS":[],"style":"style/visual.less","capabilities":{"dataRoles":[{"displayName":"Values","kind":"GroupingOrMeasure","name":"Values"}],"dataViewMappings":[{"scriptResult":{"dataInput":{"table":{"rows":{"select":[{"for":{"in":"Values"}}],"dataReductionAlgorithm":{"top":{}}}}},"script":{"scriptProviderDefault":"R","scriptOutputType":"html","source":{"objectName":"rcv_script","propertyName":"source"},"provider":{"objectName":"rcv_script","propertyName":"provider"},"scriptSourceDefault":"FlattenHTML <- function(fnameIn, fnameOut)\n{\n  library(XML)\n  \n  # Read and parse HTML file\n  if(!file.exists(fnameIn))\n    return(FALSE)\n  \n  dir = dirname(fnameIn)\n  html = htmlTreeParse(fnameIn,useInternal = TRUE)\n  top = xmlRoot(html)\n  \n  # extract all <script> tags with src value\n  srcNode=getNodeSet(top, '//script[@src]')\n  for (node in srcNode)\n  {\n    b=xmlAttrs(node)\n    f = file.path(dir, b['src'])\n    alternateSrc = FindSrcReplacement(f)\n    if (!is.null(alternateSrc))\n    {\n      s = alternateSrc\n      names(s)=c('src')\n      newNode=xmlNode(\"script\",attrs=s)\n      replaceNodes(node, newNode)\n    }else{\n      str=ReadFileForEmbedding(b['src']);\n      if (is.null(str)) continue\n      \n      newNode=xmlNode(\"script\", str, attrs=c(type=\"text/javascript\"))\n      replaceNodes(node, newNode)\n    }\n  }\n  \n  # extract all <link> tags with src value\n  linkNode=getNodeSet(top, '//link[@href]')\n  for (node in linkNode)\n  {\n    b=xmlAttrs(node)\n    f = file.path(dir, b['href'])\n    str=ReadFileForEmbedding(f);\n    if (is.null(str)) continue\n    \n    newNode=xmlNode(\"style\", str)\n    replaceNodes(node, newNode)\n  }\n  \n  saveXML(html, file=fnameOut)\n  return(TRUE)\n}\n\nReadFullFile <- function(fname)\n{\n  if(!file.exists(fname))\n    return(NULL)\n\n  con=file(fname,open=\"r\")\n  data = readLines(con)\n  close(con)\n  return(data)\n}\n\nReadFileForEmbedding <- function(fname)\n{\n  data = ReadFullFile(fname)\n  if (is.null(data))\n    return(NULL)\n\n  str = paste(data, collapse ='\\n')\n  str = paste(cbind('// <![CDATA[', str,'// ]]>'), collapse ='\\n')\n  return(str)\n}\n\nFindSrcReplacement <- function(str)\n{\n  str <- iconv(str, to=\"UTF-8\")\n  pattern = \"plotlyjs-(\\\\w.+)/plotly-latest.min.js\"\n  match1=regexpr(pattern, str)\n  attr(match1, 'useBytes')<-FALSE\n  strMatch=regmatches(str, match1, invert = FALSE)\n  if (length(strMatch)==0) return(NULL)\n  \n  pattern2 = \"-(\\\\d.+)/\"\n  match2 = regexpr(pattern2, strMatch[1])\n  attr(match2, 'useBytes')<-FALSE\n  s=regmatches(strMatch[1], match2)\n  if (length(s)==0) return(NULL)\n  \n  verstr=substr(s, 2, nchar(s)-1)\n  str = paste('https://cdn.plot.ly/plotly-', verstr,'.min.js', sep='')\n  return(str)\n}\n\ninternalSaveWidget <- function(w, fname)\n{\n  saveWidget(w, file=fname, selfcontained = FALSE)\n  FlattenHTML(fname, fname)\n}\n####################################################################\n\n###############Library Declarations###############\n\nlibraryRequireInstall = function(packageName, ...)\n{\n  if(!require(packageName, character.only = TRUE)) \n    warning(paste(\"*** The package: '\", packageName, \"' was not installed ***\",sep=\"\"))\n}\n\n#ets\nlibraryRequireInstall(\"htmlwidgets\")\nlibraryRequireInstall(\"ggplot2\")\nlibraryRequireInstall(\"plotly\")\n\n###############Internal parameters definitions#################\n\n# actual code here\ndataset2 <- Values\ndataset2 <- aggregate(dataset2, by = list(dataset2$Year), FUN = mean, na.rm = TRUE )\n\nattach(dataset2)\np <- plot_ly(dataset2, x = Year, y = Value)\np <- add_trace(p, y = fitted(loess(Value ~ as.numeric(Year))), x = Year)\np <- layout(p, title = \"# Road Accidents (per year)\", showlegend = FALSE)\ndetach(dataset2)\n# code end\n\nw = as.widget(p)\ninternalSaveWidget(w, 'out.html')\n\n#Sys.sleep(20)\n####################################################################"}}}],"objects":{"rcv_script":{"properties":{"provider":{"type":{"text":true}},"source":{"type":{"scripting":{"source":true}}}}}},"suppressDefaultTitle":true},"dependencies":{"cranPackages":[{"name":"ggplot2","displayName":"GG Plot 2","url":"https://cran.r-project.org/web/packages/ggplot2/index.html"},{"name":"plotly","displayName":"Plotly","url":"https://cran.r-project.org/web/packages/plotly/index.html"},{"name":"htmlwidgets","displayName":"htmlwidgets","url":"https://cran.r-project.org/web/packages/htmlwidgets/index.html"}]},"content":{"js":"var powerbi;\r\n(function (powerbi) {\r\n    var extensibility;\r\n    (function (extensibility) {\r\n        var visual;\r\n        (function (visual) {\r\n            var PBI_CV_E67F6187_8266_4C40_822B_369EDD127725;\r\n            (function (PBI_CV_E67F6187_8266_4C40_822B_369EDD127725) {\r\n                var nonAcceptedNodes = [\r\n                    'META',\r\n                ];\r\n                var injectorCounter = 0;\r\n                function ResetInjector() {\r\n                    injectorCounter = 0;\r\n                }\r\n                PBI_CV_E67F6187_8266_4C40_822B_369EDD127725.ResetInjector = ResetInjector;\r\n                function injectorReady() {\r\n                    return injectorCounter == 0;\r\n                }\r\n                PBI_CV_E67F6187_8266_4C40_822B_369EDD127725.injectorReady = injectorReady;\r\n                function ParseElement(el, target) {\r\n                    //  debugger;\r\n                    var arr = [];\r\n                    var nodes = el.children;\r\n                    for (var i = 0; i < nodes.length; i++) {\r\n                        if (nonAcceptedNodes.indexOf(nodes.item(i).nodeName) != -1) {\r\n                            continue;\r\n                        }\r\n                        var tempNode = void 0;\r\n                        if (nodes.item(i).nodeName.toLowerCase() == 'script') {\r\n                            tempNode = createScriptNode(nodes.item(i));\r\n                        }\r\n                        else {\r\n                            tempNode = nodes.item(i).cloneNode(true);\r\n                        }\r\n                        target.appendChild(tempNode);\r\n                        arr.push(tempNode);\r\n                    }\r\n                    return arr;\r\n                }\r\n                PBI_CV_E67F6187_8266_4C40_822B_369EDD127725.ParseElement = ParseElement;\r\n                function createScriptNode(refNode) {\r\n                    var script = document.createElement('script');\r\n                    var attr = refNode.attributes;\r\n                    for (var i = 0; i < attr.length; i++) {\r\n                        script.setAttribute(attr[i].name, attr[i].textContent);\r\n                        if (attr[i].name.toLowerCase() === 'src') {\r\n                            // waiting only for src to finish loading\r\n                            injectorCounter++;\r\n                            script.onload = function () {\r\n                                injectorCounter--;\r\n                            };\r\n                        }\r\n                    }\r\n                    script.innerHTML = refNode.innerHTML;\r\n                    return script;\r\n                }\r\n            })(PBI_CV_E67F6187_8266_4C40_822B_369EDD127725 = visual.PBI_CV_E67F6187_8266_4C40_822B_369EDD127725 || (visual.PBI_CV_E67F6187_8266_4C40_822B_369EDD127725 = {}));\r\n        })(visual = extensibility.visual || (extensibility.visual = {}));\r\n    })(extensibility = powerbi.extensibility || (powerbi.extensibility = {}));\r\n})(powerbi || (powerbi = {}));\r\nvar powerbi;\r\n(function (powerbi) {\r\n    var extensibility;\r\n    (function (extensibility) {\r\n        var visual;\r\n        (function (visual) {\r\n            var PBI_CV_E67F6187_8266_4C40_822B_369EDD127725;\r\n            (function (PBI_CV_E67F6187_8266_4C40_822B_369EDD127725) {\r\n                function getValue(objects, objectName, propertyName, defaultValue) {\r\n                    if (objects) {\r\n                        var object = objects[objectName];\r\n                        if (object) {\r\n                            var property = object[propertyName];\r\n                            if (property !== undefined) {\r\n                                return property;\r\n                            }\r\n                        }\r\n                    }\r\n                    return defaultValue;\r\n                }\r\n                PBI_CV_E67F6187_8266_4C40_822B_369EDD127725.getValue = getValue;\r\n                function getFillValue(objects, objectName, propertyName, defaultValue) {\r\n                    if (objects) {\r\n                        var object = objects[objectName];\r\n                        if (object) {\r\n                            var fill = object[propertyName];\r\n                            if (fill !== undefined && fill.solid !== undefined && fill.solid.color !== undefined) {\r\n                                return fill.solid.color;\r\n                            }\r\n                        }\r\n                    }\r\n                    return defaultValue;\r\n                }\r\n                PBI_CV_E67F6187_8266_4C40_822B_369EDD127725.getFillValue = getFillValue;\r\n            })(PBI_CV_E67F6187_8266_4C40_822B_369EDD127725 = visual.PBI_CV_E67F6187_8266_4C40_822B_369EDD127725 || (visual.PBI_CV_E67F6187_8266_4C40_822B_369EDD127725 = {}));\r\n        })(visual = extensibility.visual || (extensibility.visual = {}));\r\n    })(extensibility = powerbi.extensibility || (powerbi.extensibility = {}));\r\n})(powerbi || (powerbi = {}));\r\n/*\r\n *  Power BI Visual CLI\r\n *\r\n *  Copyright (c) Microsoft Corporation\r\n *  All rights reserved.\r\n *  MIT License\r\n *\r\n *  Permission is hereby granted, free of charge, to any person obtaining a copy\r\n *  of this software and associated documentation files (the \"\"Software\"\"), to deal\r\n *  in the Software without restriction, including without limitation the rights\r\n *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n *  copies of the Software, and to permit persons to whom the Software is\r\n *  furnished to do so, subject to the following conditions:\r\n *\r\n *  The above copyright notice and this permission notice shall be included in\r\n *  all copies or substantial portions of the Software.\r\n *\r\n *  THE SOFTWARE IS PROVIDED *AS IS*, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n *  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n *  THE SOFTWARE.\r\n */\r\nvar powerbi;\r\n(function (powerbi) {\r\n    var extensibility;\r\n    (function (extensibility) {\r\n        var visual;\r\n        (function (visual) {\r\n            var PBI_CV_E67F6187_8266_4C40_822B_369EDD127725;\r\n            (function (PBI_CV_E67F6187_8266_4C40_822B_369EDD127725) {\r\n                // Below is a snippet of a definition for an object which will contain the property values\r\n                // selected by the users\r\n                /*interface VisualSettings {\r\n                    lineColor: string;\r\n                }*/\r\n                // To allow this scenario you should first the following JSON definition to the capabilities.json file\r\n                // under the \"objects\" property:\r\n                // \"settings\": {\r\n                //     \"displayName\": \"Visual Settings\",\r\n                //     \"description\": \"Visual Settings Tooltip\",\r\n                //     \"properties\": {\r\n                //         \"lineColor\": {\r\n                //         \"displayName\": \"Line Color\",\r\n                //         \"type\": { \"fill\": { \"solid\": { \"color\": true }}}\r\n                //         }\r\n                //     }\r\n                // }\r\n                var renderVisualUpdateType = [4, 32, 36];\r\n                var Visual = (function () {\r\n                    // Snippet for defining the member property which will hold the property pane values\r\n                    /*private settings: VisualSettings;*/\r\n                    function Visual(options) {\r\n                        this.rootElement = options.element;\r\n                        this.headNodes = [];\r\n                        this.bodyNodes = [];\r\n                    }\r\n                    Visual.prototype.update = function (options) {\r\n                        var dataViews = options.dataViews;\r\n                        if (!dataViews || dataViews.length === 0)\r\n                            return;\r\n                        var dataView = dataViews[0];\r\n                        if (!dataView || !dataView.metadata)\r\n                            return;\r\n                        this.updateObjects(dataView.metadata.objects);\r\n                        var payloadBase64 = null;\r\n                        if (dataView.scriptResult && dataView.scriptResult.payloadBase64) {\r\n                            payloadBase64 = dataView.scriptResult.payloadBase64;\r\n                        }\r\n                        //debugger;\r\n                        if (renderVisualUpdateType.indexOf(options.type) == -1) {\r\n                            if (payloadBase64) {\r\n                                debugger;\r\n                                this.injectCodeFromPayload(payloadBase64);\r\n                            }\r\n                        }\r\n                        this.onResizing(options.viewport);\r\n                    };\r\n                    Visual.prototype.onResizing = function (finalViewport) {\r\n                    };\r\n                    Visual.prototype.injectCodeFromPayload = function (payloadBase64) {\r\n                        PBI_CV_E67F6187_8266_4C40_822B_369EDD127725.ResetInjector();\r\n                        var el = document.createElement('html');\r\n                        el.innerHTML = window.atob(payloadBase64);\r\n                        var head = el.getElementsByTagName('head')[0];\r\n                        var body = el.getElementsByTagName('body')[0];\r\n                        // update the header data only on the 1st update\r\n                        if (this.headNodes.length == 0) {\r\n                            this.headNodes = PBI_CV_E67F6187_8266_4C40_822B_369EDD127725.ParseElement(head, document.head);\r\n                        }\r\n                        while (this.bodyNodes.length > 0) {\r\n                            var tempNode = this.bodyNodes.pop();\r\n                            document.body.removeChild(tempNode);\r\n                        }\r\n                        this.bodyNodes = PBI_CV_E67F6187_8266_4C40_822B_369EDD127725.ParseElement(body, document.body);\r\n                        var intervalVar = window.setInterval(function () {\r\n                            if (PBI_CV_E67F6187_8266_4C40_822B_369EDD127725.injectorReady()) {\r\n                                window.clearInterval(intervalVar);\r\n                                console.log('Render');\r\n                                if (window.hasOwnProperty('HTMLWidgets')) {\r\n                                    window['HTMLWidgets'].staticRender();\r\n                                }\r\n                            }\r\n                        }, 100);\r\n                    };\r\n                    /**\r\n                     * This function gets called by the update function above. You should read the new values of the properties into\r\n                     * your settings object so you can use the new value in the enumerateObjectInstances function below.\r\n                     *\r\n                     * Below is a code snippet demonstrating how to expose a single property called \"lineColor\" from the object called \"settings\"\r\n                     * This object and property should be first defined in the capabilities.json file in the objects section.\r\n                     * In this code we get the property value from the objects (and have a default value in case the property is undefined)\r\n                     */\r\n                    Visual.prototype.updateObjects = function (objects) {\r\n                        /*this.settings = <VisualSettings>{\r\n                            lineColor: getFillValue(object, 'settings', 'lineColor', \"#333333\")\r\n                        };*/\r\n                    };\r\n                    /**\r\n                     * This function gets called for each of the objects defined in the capabilities files and allows you to select which of the\r\n                     * objects and properties you want to expose to the users in the property pane.\r\n                     *\r\n                     * Below is a code snippet for a case where you want to expose a single property called \"lineColor\" from the object called \"settings\"\r\n                     * This object and property should be first defined in the capabilities.json file in the objects section.\r\n                     */\r\n                    Visual.prototype.enumerateObjectInstances = function (options) {\r\n                        var objectName = options.objectName;\r\n                        var objectEnumeration = [];\r\n                        /*switch( objectName ){\r\n                            case 'settings':\r\n                                objectEnumeration.push({\r\n                                    objectName: objectName,\r\n                                    properties: {\r\n                                        lineColor: this.settings.lineColor,\r\n                                     },\r\n                                    selector: null\r\n                                });\r\n                                break;\r\n                        };*/\r\n                        return objectEnumeration;\r\n                    };\r\n                    return Visual;\r\n                }());\r\n                PBI_CV_E67F6187_8266_4C40_822B_369EDD127725.Visual = Visual;\r\n            })(PBI_CV_E67F6187_8266_4C40_822B_369EDD127725 = visual.PBI_CV_E67F6187_8266_4C40_822B_369EDD127725 || (visual.PBI_CV_E67F6187_8266_4C40_822B_369EDD127725 = {}));\r\n        })(visual = extensibility.visual || (extensibility.visual = {}));\r\n    })(extensibility = powerbi.extensibility || (powerbi.extensibility = {}));\r\n})(powerbi || (powerbi = {}));\r\nvar powerbi;\r\n(function (powerbi) {\r\n    var visuals;\r\n    (function (visuals) {\r\n        var plugins;\r\n        (function (plugins) {\r\n            plugins.PBI_CV_E67F6187_8266_4C40_822B_369EDD127725 = {\r\n                name: 'PBI_CV_E67F6187_8266_4C40_822B_369EDD127725',\r\n                displayName: 'RPlotSmooth',\r\n                class: 'Visual',\r\n                version: '1.0.0',\r\n                apiVersion: '1.4.0',\r\n                create: function (options) { return new powerbi.extensibility.visual.PBI_CV_E67F6187_8266_4C40_822B_369EDD127725.Visual(options); },\r\n                custom: true\r\n            };\r\n        })(plugins = visuals.plugins || (visuals.plugins = {}));\r\n    })(visuals = powerbi.visuals || (powerbi.visuals = {}));\r\n})(powerbi || (powerbi = {}));\r\n//# sourceMappingURL=visual.js.map","css":".visual-PBI_CV_E67F6187_8266_4C40_822B_369EDD127725 .rcv_autoScaleImageContainer {\n  position: relative;\n}\n.visual-PBI_CV_E67F6187_8266_4C40_822B_369EDD127725 .rcv_autoScaleImageContainer .rcv_autoScaleImage {\n  max-width: 100%;\n  max-height: 100%;\n  position: absolute;\n  top: 50%;\n  \n  left: 50%;\n  transform: translateY(-50%) translateX(-50%);\n  -webkit-transform: translateY(-50%) translateX(-50%);\n}\n.visual-PBI_CV_E67F6187_8266_4C40_822B_369EDD127725 iframe {\n  border: none !important;\n}\n","iconBase64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTCtCgrAAAACt0lEQVQ4T8WUX0hTYRjGz7ZzdjY359ycmgz6QyVEmKGU1IUWZYFgEe5C8SohKzCNboKoQUGlgUJeREGBWvTHogTTUiMjtChtWFrM6kJsFloqRf+gnqfP8WHEUtdVP3gv3vd73uc8B75zlP8K+z12hGI2IajuwYDtKJ6Zy/HUmSaPowdvbcsxamrAkPEbnyvkM1lPRfUpREA7JaWzQyomjuvHMab8YFAaPDEQLdpXnLQFsStujEVOslklHjtWybW/Ayg6JtSb/CBM+qdSGH6iV21EiyOXPRnalIanMzRsc13mOZ18oOeEF2cC79ULnDCIVCJRr+kTAjF58ugPUG2rQqcW4t1sixxFgneWIo4LsxfC7JEw63FlyaNpcC9pIdr1SrRrX9Bh2yjHkWBwsY6QGmLISHQZf6LrdzKMJizBoH4EnXo/WlWgRR1Ha+xfk0+DVyLdsJEMmIhO85mpGSfjFmHMco1Bjbytkk0acUO/jmtWb3hpNjCgX+VLYdamfkebOwWT8Zs4qk0yIMyuC6OL5hE02rdI+dygRx/mQ3ENmkSC1wlLMWT+yG4zed5MVFnvoCzZI6Vzw36/Wbwm2CyWL1t3os9+iV0W8qxOVFha6VNMUhoduOV1TZmxThjUJWei3fqZ9VbSL/odyZlSFj1oSEllvYWotU7wisfO8zFktagKYVjsXi9l0cNadw5rYojK2Ebx2RlQ4xih307uthL59lskDVIaHTjsLOYhYXDA5Qv3+x0HuddBlorKFw9abauiohjD4mjAPtcxlDve0L/MHO7LxCXf7r7PQvEDKIgnc+OItc5uZs/biqJ184X57IlREt+BksRS2YbBZmGal3gCG9xfmJ1ArhGV6SFWJt3GxjSblEVC3/xk+BKvyjYC5KfGIsu7GRneQqQvWCHHM4OCdM8/37MIFOUXcOCKM5YAXLAAAAAASUVORK5CYII="}}